# SPDX-License-Identifier: (GPL-2.0-only OR BSD-2-Clause)
%YAML 1.2
---
$id: http://devicetree.org/schemas/phy/sophgo,cv1800-usb-phy.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

title: Sophgo CV18XX/SG200X USB 2.0 PHY

maintainers:
  - Inochi Amaoto <inochiama@outlook.com>

properties:
  compatible:
    const: sophgo,cv1800-usb-phy

  reg:
    maxItems: 1

  "#phy-cells":
    const: 0

  clocks:
    items:
      - description: PHY clock
      - description: PHY app clock
      - description: PHY stb clock
      - description: PHY lpm clock

  clock-names:
    items:
      - const: phy
      - const: app
      - const: stb
      - const: lpm

  dr_mode:
    description: PHY device mode when initing.
    enum: [host, peripheral, otg]

  vbus_det-gpios:
    description: GPIO to the USB OTG VBUS detect pin. This should not be
      defined if vbus_det gpio and switch gpio are connected.
    maxItems: 1

  sophgo,switch-gpios:
    description: GPIO for the phy to control connected switch.
    maxItems: 2

required:
  - compatible
  - "#phy-cells"
  - clocks
  - clock-names
  - dr_mode

allOf:
  - if:
      properties:
        dr_mode:
          const: otg
    then:
      required:
        - vbus_det-gpios

additionalProperties: false

examples:
  - |
    phy@48 {
      compatible = "sophgo,cv1800-usb-phy";
      reg = <0x48 0x4>;
      #phy-cells = <0>;
      clocks = <&clk 92>, <&clk 93>,
               <&clk 94>, <&clk 95>;
      clock-names = "phy", "app", "stb", "lpm";
      dr_mode = "host";
    };
  - |
    #include <dt-bindings/gpio/gpio.h>

    phy@54 {
      compatible = "sophgo,cv1800-usb-phy";
      reg = <0x54 0x4>;
      #phy-cells = <0>;
      clocks = <&clk 92>, <&clk 93>,
               <&clk 94>, <&clk 95>;
      clock-names = "phy", "app", "stb", "lpm";
      dr_mode = "otg";
      vbus_det-gpios = <&portb 6 GPIO_ACTIVE_HIGH>;
    };
